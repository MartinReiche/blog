rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Auth utility functions
    function isAdmin() {
      return request.auth.token.admin == true
    }

    match /commentRequests/{document} {
        allow read: if isAdmin()
        allow create:
            if request.resource.data.keys().hasOnly(['name', 'message', 'uid', 'pathname', 'title', 'createdAt'])
            && request.resource.data.name is string
            && request.resource.data.message is string
            && request.resource.data.uid is string
            && request.resource.data.pathname is string
            && request.resource.data.title is string
            && request.resource.data.createdAt is timestamp
        allow delete: if isAdmin()
    }

    match /rejectedComments/{document} {
        allow read: if isAdmin()
        allow create:
            if request.resource.data.keys().hasOnly(['name', 'message', 'uid', 'pathname', 'title', 'createdAt'])
            && isAdmin()
            && request.resource.data.name is string
            && request.resource.data.message is string
            && request.resource.data.uid is string
            && request.resource.data.pathname is string
            && request.resource.data.title is string
            && request.resource.data.createdAt is timestamp
    }

    match /comments/{document} {
        allow read: if true
        allow create:
            if request.resource.data.keys().hasOnly(['name', 'message', 'uid', 'pathname', 'createdAt'])
            && isAdmin()
            && request.resource.data.name is string
            && request.resource.data.message is string
            && request.resource.data.uid is string
            && request.resource.data.pathname is string
            && request.resource.data.createdAt is timestamp
        allow delete: if isAdmin()
    }
  }
}